---
title: 八大技术架构与演进1
date: 2024-11-10 16:44:45
tags:
  - "#中间件"
categories:
  - docker
---

随着互联网技术的发展，业务规模和数据量不断扩大，为了能够又快又精确的为用户提供服务，技术架构也不断演进，来适应不同时期的业务需求

本文主要介绍八种业务架构以及优缺点和演进的过程

## 单机架构

也称之为单体架构，主要指的是将系统的各个模块集成在一起形成一个整体的应用，通常是一整个服务器为用户提供服务

我们可以用一个简单的网站服务来画一个示意图

![image.png](https://s2.loli.net/2024/11/10/8kuTSbplN7RZXBq.png)

我们输入目标服务器的域名之后，会先访问DNS服务获取服务器的IP地址，然后在由服务器为用户提供服务，这里的网站服务和数据库服务是处于同一台机器的，因此也就是单机服务

**特点**：系统的各个模块集成在一起形成一个整体应用，通常由一个大型代码库管理 每次部署和更新都需要发布整个应用

**优点**：适合初期开发和快速上线，维护成本低，开发和测试相对简单

**缺点**：随着业务复杂度增加，单体架构的维护变得困难，更新和部署风险高，扩展性有限，容易出现性能瓶颈

### 相关软件

Web 服务器软件：Tomcat、Netty、Nginx、Apache 等

数据库软件：MySQL、Oracle、PostgreSQL、SQL Server 等

## 应用数据分离架构

当服务器的资源不够用的时候，一种很自然的想法就是把应用服务和数据库服务分放在两台服务器中，这样就能缓解服务器的压力了

这样我们也能画出一个示意图

![image.png](https://s2.loli.net/2024/11/10/VuvmyFjzablQgof.png)

**特点**：应用数据分离架构将应用层和数据层独立开来，应用层负责业务逻辑处理，数据层则专注于数据的存储和管理 这种架构通过在应用和数据之间设置中间件或缓存层，实现数据的独立管理和灵活调用

**优点**：通过数据和应用的分离，降低了应用层的复杂性，提高了系统的扩展性 数据层可以独立优化，提升数据处理和查询的性能。同时，数据可以被多个应用复用，减少冗余

**缺点**：需要解决数据一致性和同步问题，特别是在高并发场景中，数据分离可能增加一致性管理的复杂度 此外，数据分离架构对中间件的稳定性和数据访问效率有较高要求，运维成本也会随之上升

> 中间件：一类提供不同应用程序用于相互通信的软件，即处于不同技术、工具和数据库之间的桥梁，就例如这里应用服务器和数据库服务器之间的通信就需要中间件

## 应用服务集群架构

当用户数量进一步上升时，我们会发现一台应用服务器以及难以满足大量用户的需求了

这时候就可以有两种扩展思路

一种就是单纯提升这一台服务器的性能，也称之为纵向扩展，垂直扩展，好处就是可以不需要对系统进行调整，但是缺点也很明显，性能和价格并非线性的关系，两倍性能提升的硬件可能需要远超两倍价格的资金

另一种就是横向扩展，水平扩展，我们对软件架构进行调整，添加应用层的硬件，说人话就是再买一台服务器，采用负载均衡的方式来对用户进行分流，这种方案的优势就在于成本更低，也更方便提供，劣势就是给系统提供了更多的复杂性

> 负载均衡：通过评估不同服务器，将用户选择性的分流给某个服务器，实现不会出现服务器饿死或者累死的情况
>
> 实际中负载均衡不仅仅指的是工作在应用层的， 甚至可能是其他的网络层之中。同时流量调度算法也有很多种，这里简单介绍几种较 为常见的：
>
> Round-Robin 轮询算法。即非常公平地将请求依次分给不同的应用服务器
>
> Weight-Round-Robin 轮询算法。为不同的服务器（比如性能不同）赋予不同的权 重（weight），能者多劳
>
> 一致哈希散列算法。通过计算用户的特征值（比如 IP 地址）得到哈希值，根据哈 希结果做分发，优点是确保来自相同用户的请求总是被分给指定的服务器。也就是我 们平时遇到的专项客户经理服务

这里我们可以画出来横向扩展的示意图

![image.png](https://s2.loli.net/2024/11/10/XdblJBpAojnMWGh.png)

这里还有一种区别就是应用服务器可以选择是否通过负载均衡来返回给用户，也可以直接返回

**特点**：应用服务集群架构通过将应用服务部署在多个服务器节点上，形成一个服务集群，使得每个节点可以处理用户请求。通常使用负载均衡器分配流量，确保系统的高可用性和均衡的负载。

**优点**：集群架构提高了系统的扩展性和容错能力，能够有效应对高并发和大流量的访问需求。即使个别节点出现故障，其他节点也能继续提供服务，保障系统的高可用性。

**缺点**：需要管理集群中的节点一致性、故障处理和负载均衡机制，增加了运维和管理的复杂性。数据一致性和状态同步也是集群架构中的技术挑战。

### 相关软件

负载均衡软件：Nginx、HAProxy、LVS、F5 等

## 读写分离/主从分离架构

当应用服务器逐渐增多时，一台数据库服务器可能以及难以满足我们的需求了，但是这里最重要的问题是需要确保数据库服务器的一致性，因此我们采用的解决方案是使用主从服务器，将主数据库服务器用于写，其他的从属服务器用于读数据库服务器，当主数据库改变时，就需要同步到从属服务器中

![image.png](https://s2.loli.net/2024/11/10/krAc1zpyIb3sWhH.png)

**特点**：读写分离架构（也称主从分离架构）通过将数据库的读操作和写操作分离，通常在主数据库上进行写操作，在多个从数据库上进行读操作。主数据库同步更新从数据库的数据，以确保读写数据的一致性。

**优点**：显著提高系统的读操作性能，减轻主数据库的压力，适合读多写少的应用场景。此外，从数据库可以横向扩展，增强系统的扩展性和负载能力。

**缺点**：主从同步会带来一定的延迟，可能导致短暂的数据不一致，特别是在强一致性要求较高的系统中。此外，主数据库的压力仍较大，需要考虑主库的高可用设计。

### 相关软件

MyCat、TDDL、Amoeba、Cobar 等类似数据库中间件等

## 冷热分离架构

进一步，当数据库中的数据非常庞大时，也是一件非常耗时的事情，我们能不能提升速度呢

我们可以将内存利用起来，把使用频率非常高的数据存储在其中，也就是缓存，当想要访问热点数据时，直接从缓存中获取并返回即可，这样就能降低数据库的压力了

当然缓存也会涉及到一些缓存一致性，缓存击穿，缓存雪崩，热点数据集中失效等问题

示意图是这样的

![image.png](https://s2.loli.net/2024/11/10/3UqC7ZszOGwA8l5.png)

**特点**：冷热分离架构将数据分为“热数据”和“冷数据”进行独立存储和管理。热数据指的是高频访问的数据，通常存储在高性能存储介质上，便于快速访问；冷数据则是访问频率较低的数据，存储在成本较低的介质上。冷热数据之间根据访问需求定期迁移。

**优点**：通过将高频访问的数据置于高性能存储中，提高了系统的响应速度和用户体验，同时降低了整体存储成本。适合数据量大且访问频率差异显著的场景，例如电商、日志系统等。

**缺点**：冷热数据的分离和迁移需要额外的管理策略和运维支持，尤其是在冷热数据的划分和定期调整方面。此外，冷数据存取速度较慢，可能影响对历史数据的快速查询。

### 相关软件

Memcached、Redis 等缓存软件

## 垂直分库架构

当数据量不断增大，大量的数据都存储在一个库中就已经不太够用了，这时候就可以讲不同的数据分类别存储Mycat也支持在大表拆分为小标的情况下进行访问

但是这种做法其实是增加了数据库的运维难度，这种其实也就叫做分布式数据库，逻辑上是一整个大的数据库，但是实际上却是由各个分开的数据库来组合实现的功能

![image.png](https://s2.loli.net/2024/11/12/xdo3YPMa9eHm4pj.png)

**特点**：垂直分库架构是将单一数据库按业务模块进行拆分，不同业务模块的数据存储在独立的数据库中。比如，在一个电商系统中，可以将用户数据、订单数据、商品数据分别存储在不同的数据库中，以减少单库的负载。

**优点**：垂直分库可以有效降低单库的压力，减轻数据库的负载，增强系统的扩展性和稳定性。业务模块相对独立，便于优化不同数据库的配置，提高每个业务模块的查询和处理性能。

**缺点**：分库后需要处理跨库查询和事务问题，导致应用复杂度增加。不同数据库之间的联动和数据一致性管理难度较大。此外，垂直分库依赖于对业务的清晰拆分，不适合业务边界模糊的场景。

### 相关软件

Greenplum、TiDB、Postgresql XC、HAWQ 等，商用的如南大通用的 GBase、 睿帆科技的雪球 DB、华为的 LibrA 等

## 微服务架构

当应用服务特别多时，我们想要对应用进行维护更新就会变得非常困难

我们可以将不同的业务分给不同的开发团队去维护，每个团队独立实现自己的微服务，互相之间的数据进行隔离

![image.png](https://s2.loli.net/2024/11/12/49jRlDXMbhUqcKQ.png)

### 相关软件

Spring Cloud、Dubbo

## 容器化架构

随着业务的增长，我们发现很多时候系统的利用效率不高，我们需要动态的管理服务器的资源

这就要求我们可以方便快捷的进行服务的部署

可是不同机器的状况是不尽相同的，运维工作量非常大，这时候就需要容器化技术了

docker就是一种，可以把应用和服务打包为一个镜像，然后通过k8s来动态分发和部署镜像

我们把运行环境全部都打包好，直接进行服务的部署即可

在同一台服务器中，可以由很多个不同的镜像运行，他们之间是独立的，我们甚至可以粗暴的任务，一个docker容器就是一个简单的操作系统
