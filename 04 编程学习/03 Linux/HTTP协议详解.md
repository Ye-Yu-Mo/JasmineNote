---
title: Linux网络——HTTP协议详解(1)
date: 2024-09-18 16:29:03
tags: [C++,Linux,网络]
categories: [Linux]
---

## HTTP协议

HTTP可以说是当今应用最广泛的应用层协议之一，主要面向的是浏览器（客户端）和服务器之间通信的规定

HTTP协议的底层是TCP协议，我们先大概认识一下这个协议是如何使用的

### URL

URL也称为统一资源定位器，但其实我们可以感性的将其看作网址

例如`https://www.google.com`，但这个其实是省略过后的，完整的长这样

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/b25f47631d5ed44a78f579cdb4239f00.png)

* http就是标识用的http协议，https可以先认为他是一个安全加密版本的http
* 登录信息一般都不太带了，因为有了数据库等线上的注册登录系统
* 服务器地址也就是我们常说的域名，他的本质就是用来表示IP地址
  * 因为这个点分十进制四个大数字太难记住，但是像`baidu`这样的拼音就好记很多
  * DNS是域名服务器，他的工作就是将域名解析成IP地址
* 服务器端口号就是对应着Socket编程的端口号，HTTP的默认端口号一般固定为80，不允许更改
* 带层次的文件路径，`/`与系统并不同，他表示的是网络根目录，下一篇我们会讲
* 在`?`之后的是传递的参数

### HTTP报文

无论是客户端服务器（CS）还是浏览器服务器（BS）

都是通过报文传递信息的，我们将其分为请求报文和响应报文

请求报文可以在服务器端完整收到，而响应报文可以通过telnet或者wireshark等抓包工具拿到

#### 请求报文

这里我们写了一个简单的程序，获得了请求的报文，是长这个样子的

![img](https://s2.loli.net/2024/09/18/ux3bODtMERgCq2J.png)

虽然看起来很乱，但是可以分为三个部分，请求行，报头，空行，正文

第一行就是请求行，主要有三个内容，第一个是请求方法，这里我们看到是GET，其实还有别的方法，第二个是url，第三个是版本，有1.0短连接，1.1长连接和2.0

第二部分就是各种属性值了，用键值对表示

前两部分其实才是真正的全部报头，用空行来跟正文进行分割

正文部分是可有可无的

#### 响应报文

![image.png](https://s2.loli.net/2024/09/18/OVPgEHkW6vfdAQC.png)

我们可以看到这个响应报文也是类似的结构

首行是版本号+状态码+状态码解释

状态码就是我们熟悉的类似404

Header就是属性值，后面就是报文的主体

## HTTP方法

HTTP方法有这些

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/e519432fbefa411d9244d491e8dc9613.png)

但是怎么说呢，这些方法只有GET和POST方法是99%情况用到的

剩下的几乎不太用，如果有兴趣可以找《图解HTTP》，是处于了解的范畴

大家肯定一看就明白的

### GET方法

GET方法就是顾名思义，要从服务器中获取某些资源所用的方法，比如说获取一个网页，图片，视频

GET方法是分为带参数的GET方法，不带参的GET方法

如果单纯是拿某一个资源，那肯定就不需要带参数，直接给路径就行

但是如果是浏览器搜索关键词，登录，就需要把浏览器客户端的内容传递给服务器

而GET方法显著区别于POST方法的就是，他提供参数是通过URL传递的

也就是将参数以键值对的方式添加在URL之后传过去，服务器再解析URL拿到数据

### POST方法

POST方法要使用主要就是要上传数据给服务器，但是传递的数据并不在URL

而是在请求正文中，在HTTP的报头里面

相对来说POST方法比GET方法好一点，至少在你的浏览器地址栏里面看不到账号和密码

但是这两者都并不安全，没有加密，一旦被劫持还是会泄漏数据的

## 状态码与报头

### 状态码

状态码就是200 OK，404 NOT FOUND

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/22069a71ba8ba409696f91cd7d1e3d8f.png)

我们需要记住的其实就是大概知道是哪里出问题了，2开头的基本上没问题，3开头是可以重定向操作，4开头就是请求错了，5开头是服务器错误

这个状态码也只是一个提示性的规范性的信息，也不一定需要完全遵守，因此只能大概了解

3开头的重定向操作还是蛮有用的，就类似于手机的呼叫转移，当某一个网站（服务器）暂时无法访问时，可以转接到另一个网站或者服务器，在某些情况下，这种转接甚至是永久的（301）

### 报头

报头也算hander，本质其实就是键值对，是用来给服务器提供信息的

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/176de55178f92e0161057d62b6025330.png)

其中cookie保存的是登录信息，这个东西是浏览器提供的，而非HTTP协议做到的，HTTP协议记不住任何东西

## 会话

浏览器能记住，也就是cookie，他可以存在内存里，也可以存在一个单独的cookie文件，当账号密码直接以明文的形式存在里面的时候，其实还是不安全

浏览器就会加密之类的，而且这个cookie是唯一的，存在浏览器中

服务器看到是相同的cookie就知道是同一个客户端请求的了

session也可以用来保存用户数据，但是他是存储在服务器中，而且是可以在用户关闭浏览器之后依旧绑定，安全性更高

当用户第一次访问网站时，或者登录时，将cookie会存储在客户端

这个cookie其实就是sessionID，他是唯一存在的，浏览器会将这个数据发送给服务器

接下来用户的每次都会带上这个cookie，而服务器就能根据这个id查找session，从而找到这个用户的信息


## HTTPS

这也是一个应用层协议，是在HTTP协议的基础上引入了一个加密层

为什么要加密呢，这主要是因为如果不对传输主体加密，当中间人拿到数据后，可以对其中的关键内容进行保存甚至篡改

例如说把服务器ip改成自己的，假装自己是服务器跟你通信

### 加密

加密就是把明文转换成暗文，解密则相反

在加密和解密的过程中可能需要某些数据进行辅助，这些数据称为密钥

例如说我们双方通信规定和把数据对114514按位异或

我要传输5201314这个数据，异或之后就是5169904

然后这个数据在网络上传输

你收到5169904之后，再对114514按位异或，就能得到5201314了

这样我们其实就完成了一次加密通信，但是实际情况远比这个复杂

## 常见加密方式

### 对称加密

刚刚我们传输的这个过程其实就是对称加密，我们使用了同一个密钥`114514`，也称之为单密钥加密

常见的由`DES 3DES AES TDEA Blowfish RC2`

这种加密的方式好处就是计算量小，当然是对于计算机来说

速度快，算法公开，加密效率高

但是有一个问题，我要怎么让你知道我使用的是什么方式加密呢

直接写在明文里吗，那这样别人拿到不也能解密

除此之外，服务器也不能记住所有客户端的密钥，那也太二了

因此这个方式是有很大问题的

### 非对称加密

这个方式就是说，一个密钥不够用了，那我们设置两个吧

一个是公开密钥，另一个是私有密钥

公开密钥谁都能拿到，谁都能用，但是私有密钥只有我自己用

信息用公钥进行加密，编程密钥，用私钥进行解密，变成明文

但是私钥公钥的加解密非常复杂，而且涉及到数论的知识，实际上运算速度也很慢

### 非对称+对称

因为如果双方都只使用非对称加密，这样做效率十分低下，而且也是有安全问题的

因此还是需要对称加密的

流程是这样的，当客户端和服务器第一次交流时，客户端获取到服务器中生成的公钥S，而服务器自身有私钥S'

而客户端在本地也生成一个对称加密的密钥C，用公钥S加密之后传递给服务器

之后他俩传递信息就用的是这个对称加密的密钥C

但是这样安全吗？？

也不安全，如果中间人就盯着你们俩

中间人也准备了公钥M，私钥M'

当客户端给服务器发送请求时，服务器需要把自己的公钥S返还给客户端

这个时候中间人就拿到报文，偷偷存了一份公钥S，然后进行替换！把服务器的公钥S换成自己的公钥M，然后传给客户端

此时客户端也不道啊，蒙在鼓里，自己的C用M加密，再发回去

中间人用M'解密，得到C，再用S加密传给服务器

这样做双方的交流过程其实是完全在中间人的眼里的！！

### 数据指纹

数据指纹本身并不是加密的机制，而是一种思想

将数据或者数据的一部分，通过哈希算法生成一串固定的内容

我们可以使用这种思想来存储或者查找数据，因为一旦数据的内容不同了，哈希生成的结果就不同了

## 证书

既然上面说的非对称加密都不安全了，还有解决方案吗

实际上产生这些问题的原因就是无法确定收到的那个公钥是服务器的还是中间人的

因此我们只需要让服务器的公钥有一个特别显眼的标识

### CA认证

服务器在使用HTTPS之前，需要像CA机构申请一份数字证书，里面包含了证书申请者的各种信息，签发信息、域名、申请者、有效时间、最重要的是公钥

就像开锁师傅一定都是在公安局备案过的一样

CA认证也就是权威认证机构颁发的证书，平台也会特定审查，这个认证过程都挺繁琐的，一般也都是找第三方平台帮忙解决

### 数字签名

数字签名其实就是对数据指纹进行加密，主要是用于验证的，防止数据被篡改

当我们生成了认证证书之后，如何防止证书被篡改呢

CA机构把证书的内容进行数据指纹的提取，然后用CA机构私钥加密，得到一个数字签名

跟随着证书一起发去，当对方收到这些之后，用公钥对数据签名进行解密，然后和证书进行比对，一旦出现差错，就说明证书有问题

这样做，即便是服务器自身想要修改公钥都是不行的，只能向CA机构申请，因为数字签名是由CA私钥生成的，一旦篡改就会被认为不安全

### 非对称+证书+对称

当客户端访问服务器时，服务器会给客户端返回这个证书

客户端会对证书进行校验，防止证书伪造

判断证书的有效期，颁发机构是否信任，证书是否篡改

这样就能确认公钥一定是服务器的而非中间人的了，后面的对称也都是安全的了

## 中间人

这时候中间人如果想要篡改证书几乎是不可能的了

如果说是要掉包证书，不能只改公钥，因为哈希值不一样，他没有服务器的私钥，算不出来正确的哈希值

只能向CA机构申请真的证书来掉包

但是真证书里面是有服务器的域名认证信息的，客户端收到之后就一脸蒙蔽

再其次这个申请确实麻烦，需要成本

